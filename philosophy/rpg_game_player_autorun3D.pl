/**

?- rpg_game_player_autorun3D.
This algorithm automatically tests 3D maps.  Uses apply(s1,c,e). so edit the map to include s1,c before running.
Enter filename (to be loaded from saved_games/-):
|: a
Enter X co-ordinate of starting position):
|: 14
Enter Y co-ordinate of starting position):
|: 16
Enter Z co-ordinate of starting position):
|: 5
[5,14,16][a]
[5,13,16][a]
[5,12,16][a]
[5,12,15][a]
[5,12,14][a]
[5,11,14][a]
[5,11,13][a]
[5,11,12][a,r]
[5,13,14][a,r]
[5,14,14][a,r]
[5,14,13][a,r,m]
[5,14,12][a,r,m]
[6,14,12][a,r,m]
[7,14,12][a,r,m]
[7,14,11][a,r,m]
[7,14,10][a,r,m]
[7,13,10][a,r,m]
[7,12,10][a,r,m]
[8,12,10][a,r,m]
[9,12,10][a,r,m]
[9,11,10][a,r,m,s2]
[9,12,9][a,r,m,s2]
[9,12,8][a,r,m,s2]
[9,11,8][a,r,m,s2]
[8,11,8][a,r,m,s2]
[7,11,8][a,r,m,s2]
[7,10,8][a,r,m,s2]
[7,9,8][a,r,m,s2]
[7,8,8][a,r,m,s2]
[7,10,7][a,r,m,s2]
[7,10,6][a,r,m,s2]
[7,10,5][a,r,m,s2]
[7,9,5][a,r,m,s2]
[7,8,5][a,r,m,s2]
[7,8,6][a,r,m,s2,k]
[7,9,4][a,r,m,s2,k]
[7,9,3][a,r,m,s2,k]
[7,8,3][a,r,m,s2,k]
[6,8,3][a,r,m,s2,k]
[5,8,3][a,r,m,s2,k]
[5,8,4][a,r,m,s2,k]
[5,8,5][a,r,m,s2,k]
[5,9,5][a,r,m,s2,k]
[5,10,5][a,r,m,s2,k]
[5,10,6][a,r,m,s2,k]
[5,11,6][a,r,m,s2,k]
[5,12,6][a,r,m,s2,k]
[5,12,5][a,r,m,s2,k]
[5,12,4][a,r,m,s2,k]
[5,12,3][a,r,m,s2,k]
[5,11,3][a,r,m,s2,k]
[5,10,3][a,r,m,s2,k]
[5,10,7][a,r,m,s2,k]
[5,10,8][a,r,m,s2,k]
[5,9,8][a,r,m,s2,k]
[5,8,8][a,r,m,s2,k]
[5,8,7][a,r,m,s2,k]
[4,8,7][a,r,m,s2,k]
[3,8,7][a,r,m,s2,k]
[3,8,8][a,r,m,s2,k]
[3,8,9][a,r,m,s2,k]
[3,7,9][a,r,m,s2,k]
[3,6,9][a,r,m,s2,k]
[3,6,8][a,r,m,s2,k]
[3,6,7][a,r,m,s2,k]
[3,6,10][a,r,m,s2,k]
[3,6,11][a,r,m,s2,k]
[3,5,11][a,r,m,s2,k]
[3,4,11][a,r,m,s2,k]
[2,4,11][a,r,m,s2,k]
[1,4,11][a,r,m,s2,k]
[1,4,10][a,r,m,s2,k]
[1,4,9][a,r,m,s2,k]
[1,5,9][a,r,m,s2,k]
[1,6,9][a,r,m,s2,k,c]
[1,5,11][a,r,m,s2,k,c]
[1,6,11][a,r,m,s2,k,c]
[3,6,12][a,r,m,s2,k,c]
[3,6,13][a,r,m,s2,k,c]
[3,5,13][a,r,m,s2,k,c]
[3,4,13][a,r,m,s2,k,c]
[3,3,13][a,r,m,s2,k,c]
[3,2,13][a,r,m,s2,k,c]
[3,2,12][a,r,m,s2,k,c]
[3,2,11][a,r,m,s2,k,c]
[3,2,10][a,r,m,s2,k,c]
[3,2,9][a,r,m,s2,k,c]
[3,2,8][a,r,m,s2,k,c]
[3,2,7][a,r,m,s2,k,c]
[3,3,7][a,r,m,s2,k,c]
[3,4,7][a,r,m,s2,k,c]
[3,3,9][a,r,m,s2,k,c]
[3,4,9][a,r,m,s2,k,c]
[3,7,13][a,r,m,s2,k,c]
[3,8,13][a,r,m,s2,k,c]
[3,8,12][a,r,m,s2,k,c]
[3,8,10][a,r,m,s2,k,c]
[5,11,8][a,r,m,s2,k,c]
[5,12,8][a,r,m,s2,k,c]
[7,10,3][a,r,m,s2,k,c]
[7,11,3][a,r,m,s2,k,c]
[7,12,3][a,r,m,s2,k,c]
[7,12,4][a,r,m,s2,k,c]
[7,12,5][a,r,m,s2,k,c]
[7,12,6][a,r,m,s2,k,c]
[7,11,6][a,r,m,s2,k,c]
[7,10,4][a,r,m,s2,k,c]
[7,12,8][a,r,m,s2,k,c]
[7,14,9][a,r,m,s2,k,c]
[7,14,8][a,r,m,s2,k,c]
[5,14,15][a,r,m,s2,k,c]
[5,12,17][a,r,m,s2,k,c]
[5,12,18][a,r,m,s2,k,c]
[5,11,18][a,r,m,s2,k,c]
[5,13,18][a,r,m,s2,k,c,s1,e]
Game Over
% Execution Aborted

**/

:-include('../../listprologinterpreter/la_strings.pl').
:-include('../../listprologinterpreter/la_strings_string.pl').

rpg_game_player_autorun3D :-
	writeln("This algorithm automatically tests 3D maps.  Uses apply(s1,c,e). so edit the map to include s1,c before running."),

	writeln("Enter filename (to be loaded from saved_games/*):"),
	read_string(user_input, "\n", "\r", _End3, First_item),

	string_concat("saved_games/",First_item,Game_path),
	phrase_from_file_s(string(String00a),Game_path),
		string_codes(String02b,String00a),
		atom_to_term(String02b,Map4,[]),
	retractall(map(_)),
	assertz(map(Map4)),

	writeln("Enter X co-ordinate of starting position):"),
	read_string(user_input, "\n", "\r", _End1, X1),
	number_string(X,X1),

	writeln("Enter Y co-ordinate of starting position):"),
	read_string(user_input, "\n", "\r", _End2, Y1),
	number_string(Y,Y1),

	writeln("Enter Z co-ordinate of starting position):"),
	read_string(user_input, "\n", "\r", _End4, Z1),
	number_string(Z,Z1),

	traverse(Z,X,Y).


traverse(Z,X,Y) :-
	traverse(Z,X,Y,[],_,[],_).
traverse(Z,X,Y,Explored,Explored,Inventory,Inventory) :-
	map(Map),
	member([Z,X,Y,Cell],Map),
	Cell=[*],!.
traverse(Z,X,Y,Explored,Explored,Inventory,Inventory) :-
	member([Z,X,Y],Explored),!.
traverse(Z,X,Y,Explored1,Explored2,Inventory1,Inventory2) :-
	map(Map),
	member([Z,X,Y,Cell],Map),
	write([Z,X,Y]),
	(Cell=[]->Inventory4a=Inventory1;
		(Cell=[Item],append(Inventory1,[Item],Inventory3),
		apply_all_to_all(Inventory3,Inventory4),Inventory4a=Inventory4)),
	writeln(Inventory4a),
	(member(e,Inventory4a)->(writeln("Game Over"),abort);true),
	append(Explored1,[[Z,X,Y]],Explored3),
	Xm1 is X-1,
	Ym1 is Y-1,
	Xp1 is X+1,
	Yp1 is Y+1,
	Zm1 is Z-1,
	Zp1 is Z+1,
	traverse(Z,Xm1,Y,Explored3,Explored4,Inventory4a,Inventory5),
	traverse(Z,X,Ym1,Explored4,Explored5,Inventory5,Inventory6),
	traverse(Z,Xp1,Y,Explored5,Explored6,Inventory6,Inventory7),
	traverse(Z,X,Yp1,Explored6,Explored7,Inventory7,Inventory8),
	traverse(Zm1,X,Y,Explored7,Explored8,Inventory8,Inventory9),
	traverse(Zp1,X,Y,Explored8,Explored2,Inventory9,Inventory2).

apply_all_to_all(Inventory1,Inventory2) :-
	findall(Item3,(member(Item1,Inventory1),
	member(Item2,Inventory1),not(Item1=Item2),
	apply(Item1,Item2,Item3),
	not(member(Item3,Inventory1))),
	AddedItems),
	(AddedItems=[]->Inventory1=Inventory2;
	(append(Inventory1,AddedItems,Inventory3),
	apply_all_to_all(Inventory3,Inventory2))).

%apply(k,c,m).
%apply(m,v,e).
apply(s1,c,e).